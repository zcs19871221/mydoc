<!DOCTYPE html>
<!-- saved from url=(0059)https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/ -->
<html lang="en" class=" has-js"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <title>Overview of Blocking vs Non-Blocking | Node.js</title>

  <link rel="dns-prefetch" href="http://fonts.googleapis.com/">
  <link rel="dns-prefetch" href="http://fonts.gstatic.com/">
  <link rel="dns-prefetch" href="http://www.google-analytics.com/">

  <meta name="author" content="Node.js Foundation">
  <meta name="robots" content="index, follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="apple-touch-icon" href="https://nodejs.org/static/apple-touch-icon.png">
  <link rel="icon" sizes="32x32" type="image/png" href="https://nodejs.org/static/favicon.png">

  <link rel="canonical" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/">
  <link rel="alternate" href="https://nodejs.org/en/feed/blog.xml" title="Node.js Blog" type="application/rss+xml">
  <link rel="alternate" href="https://nodejs.org/en/feed/releases.xml" title="Node.js Blog: Releases" type="application/rss+xml">
  <link rel="alternate" href="https://nodejs.org/en/feed/vulnerability.xml" title="Node.js Blog: Vulnerability Reports" type="application/rss+xml">
  <link rel="alternate" href="https://nodejs.org/en/feed/tsc-minutes.xml" title="Node.js TSC meeting minutes" type="application/rss+xml">
  <link rel="stylesheet" href="./Overview of Blocking vs Non-Blocking _ Node.js_files/styles.css" media="all">
  <link rel="stylesheet" href="./Overview of Blocking vs Non-Blocking _ Node.js_files/css">
  <script async="" src="./Overview of Blocking vs Non-Blocking _ Node.js_files/analytics.js.下载"></script><script>
  document.querySelector('html').className += " has-js";
    </script>
  </head>

<body>
  <header>
    <div class="container">
  
      <a href="https://nodejs.org/en" id="logo">
        <img src="./Overview of Blocking vs Non-Blocking _ Node.js_files/logo.svg" alt="node.js">
      </a>
  
      <nav>
        <ul class="list-divider-pipe">
          <li>
            <a href="https://nodejs.org/en/">Home</a>
          </li>
  
            <li>
              <a href="https://nodejs.org/en/about/">About</a>
            </li>
            <li>
              <a href="https://nodejs.org/en/download/">Downloads</a>
            </li>
            <li class="active">
              <a href="https://nodejs.org/en/docs/">Docs</a>
            </li>
            <li>
              <a href="https://nodejs.org/en/foundation/">Foundation</a>
            </li>
            <li>
              <a href="https://nodejs.org/en/get-involved/">Get Involved</a>
            </li>
            <li>
              <a href="https://nodejs.org/en/security/">Security</a>
            </li>
            <li>
              <a href="https://nodejs.org/en/blog/">News</a>
            </li>
        </ul>
      </nav>
  
    </div>
  </header>

  <div id="main">
    <div class="container has-side-nav">

      <aside>
        <ul>
                <li>
                      <a href="https://nodejs.org/en/docs/">Docs</a>
                </li>
                <li>
                      <a href="https://nodejs.org/en/docs/es6/">ES6 and beyond</a>
                </li>
                <li>
                      <a href="https://nodejs.org/en/docs/faq/">FAQ</a>
                </li>
                <li>
                    <a href="https://nodejs.org/dist/latest-v6.x/docs/api">v6.9.5 API <span class="small color-lightgray">LTS</span></a>
                </li>
                <li>
                    <a href="https://nodejs.org/dist/latest-v7.x/docs/api">v7.5.0 API</a>
                </li>
                <li>
                      <a href="https://nodejs.org/en/docs/guides/">Guides</a>
                </li>
        </ul>
      </aside>

      <article>
        <h1 id="header-overview-of-blocking-vs-non-blocking">Overview of Blocking vs Non-Blocking<a name="overview-of-blocking-vs-non-blocking" class="anchor" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#overview-of-blocking-vs-non-blocking" aria-labelledby="header-overview-of-blocking-vs-non-blocking"></a></h1><p>This overview covers the difference between <strong>blocking</strong> and <strong>non-blocking</strong>
calls in Node.js. This overview will refer to the event loop and libuv but no
prior knowledge of those topics is required. Readers are assumed to have a
basic understanding of the JavaScript language and Node.js callback pattern.</p>
<blockquote>
<p>"I/O" refers primarily to interaction with the system's disk and
network supported by <a href="http://libuv.org/">libuv</a>.</p>
</blockquote>
<h2 id="header-blocking">Blocking<a name="blocking" class="anchor" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#blocking" aria-labelledby="header-blocking"></a></h2><p><strong>Blocking</strong> is when the execution of additional JavaScript in the Node.js
process must wait until a non-JavaScript operation completes. This happens
because the event loop is unable to continue running JavaScript while a
<strong>blocking</strong> operation is occurring.</p>
<p>In Node.js, JavaScript that exhibits poor performance due to being CPU intensive
rather than waiting on a non-JavaScript operation, such as I/O, isn't typically
referred to as <strong>blocking</strong>. Synchronous methods in the Node.js standard library
that use libuv are the most commonly used <strong>blocking</strong> operations. Native
modules may also have <strong>blocking</strong> methods.</p>
<p>All of the I/O methods in the Node.js standard library provide asynchronous
versions, which are <strong>non-blocking</strong>, and accept callback functions. Some
methods also have <strong>blocking</strong> counterparts, which have names that end with
<code>Sync</code>.</p>
<h2 id="header-comparing-code">Comparing Code<a name="comparing-code" class="anchor" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#comparing-code" aria-labelledby="header-comparing-code"></a></h2><p><strong>Blocking</strong> methods execute <strong>synchronously</strong> and <strong>non-blocking</strong> methods
execute <strong>asynchronously</strong>.</p>
<p>Using the File System module as an example, this is a <strong>synchronous</strong> file read:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// blocks here until file is read</span>
</code></pre>
<p>And here is an equivalent <strong>asynchronous</strong> example:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The first example appears simpler than the second but has the disadvantage of
the second line <strong>blocking</strong> the execution of any additional JavaScript until
the entire file is read. Note that in the synchronous version if an error is
thrown it will need to be caught or the process will crash. In the asynchronous
version, it is up to the author to decide whether an error should throw as
shown.</p>
<p>Let's expand our example a little bit:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// blocks here until file is read</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// moreWork(); will run after console.log</span>
</code></pre>
<p>And here is a similar, but not equivalent asynchronous example:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// moreWork(); will run before console.log</span>
</code></pre>
<p>In the first example above, <code>console.log</code> will be called before <code>moreWork()</code>. In
the second example <code>fs.readFile()</code> is <strong>non-blocking</strong> so JavaScript execution
can continue and <code>moreWork()</code> will be called first. The ability to run
<code>moreWork()</code> without waiting for the file read to complete is a key design
choice that allows for higher throughput.</p>
<h2 id="header-concurrency-and-throughput">Concurrency and Throughput<a name="concurrency-and-throughput" class="anchor" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#concurrency-and-throughput" aria-labelledby="header-concurrency-and-throughput"></a></h2><p>JavaScript execution in Node.js is single threaded, so concurrency refers to the
event loop's capacity to execute JavaScript callback functions after completing
other work. Any code that is expected to run in a concurrent manner must allow
the event loop to continue running as non-JavaScript operations, like I/O, are
occurring.</p>
<p>As an example, let's consider a case where each request to a web server takes
50ms to complete and 45ms of that 50ms is database I/O that can be done
asynchronously. Choosing <strong>non-blocking</strong> asynchronous operations frees up that
45ms per request to handle other requests. This is a significant difference in
capacity just by choosing to use <strong>non-blocking</strong> methods instead of
<strong>blocking</strong> methods.</p>
<p>The event loop is different than models in many other languages where additional
threads may be created to handle concurrent work.</p>
<h2 id="header-dangers-of-mixing-blocking-and-non-blocking-code">Dangers of Mixing Blocking and Non-Blocking Code<a name="dangers-of-mixing-blocking-and-non-blocking-code" class="anchor" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#dangers-of-mixing-blocking-and-non-blocking-code" aria-labelledby="header-dangers-of-mixing-blocking-and-non-blocking-code"></a></h2><p>There are some patterns that should be avoided when dealing with I/O. Let's look
at an example:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">unlinkSync</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>In the above example, <code>fs.unlinkSync()</code> is likely to be run before
<code>fs.readFile()</code>, which would delete <code>file.md</code> before it is actually read. A
better way to write this that is completely <strong>non-blocking</strong> and guaranteed to
execute in the correct order is:</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> data<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  fs<span class="token punctuation">.</span><span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string">'/file.md'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The above places a <strong>non-blocking</strong> call to <code>fs.unlink()</code> within the callback of
<code>fs.readFile()</code> which guarantees the correct order of operations.</p>
<h2 id="header-additional-resources">Additional Resources<a name="additional-resources" class="anchor" href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#additional-resources" aria-labelledby="header-additional-resources"></a></h2><ul>
<li><a href="http://libuv.org/">libuv</a></li>
<li><a href="https://nodejs.org/en/about/">About Node.js</a></li>
</ul>

      </article>

    </div>
  </div>

  <a href="https://nodejs.org/en/docs/guides/blocking-vs-non-blocking/#" id="scroll-to-top" style="display: none;">↑ <span>Scroll to top</span></a>
  
  <footer role="contentinfo">
  
    <div class="container">
      <div class="linuxfoundation-footer">
        <div class="issue-link-container">
          <a class="linuxfoundation-logo" href="http://collabprojects.linuxfoundation.org/">
            <img alt="Linux Foundation Collaborative Projects" src="./Overview of Blocking vs Non-Blocking _ Node.js_files/lfcp.png">
          </a>
          <ul class="list-divider-pipe issue-link">
            <li><a href="https://github.com/nodejs/node/issues">Report Node.js issue</a></li>
            <li><a href="https://github.com/nodejs/nodejs.org/issues">Report website issue</a></li>
            <li><a href="https://github.com/nodejs/help/issues">Get Help</a></li>
          </ul>
        </div>
  
        <p>© 2017 Node.js Foundation. All Rights Reserved. Portions of this site originally © 2017 Joyent. </p>
        <p>Node.js is a trademark of Joyent, Inc. and is used with its permission. Please review the <a href="https://nodejs.org/static/documents/trademark-policy.pdf">Trademark Guidelines of the Node.js Foundation</a>.</p>
        <p>Linux Foundation is a registered trademark of The Linux Foundation.</p>
        <p>Linux is a registered <a href="http://www.linuxfoundation.org/programs/legal/trademark" title="Linux Mark Institute">trademark</a> of Linus Torvalds.</p>
        <p>
          <a href="https://raw.githubusercontent.com/nodejs/node/master/LICENSE">Node.js Project Licensing Information</a>.
        </p>
      </div>
    </div>
  
  </footer>
  
  <link rel="stylesheet" href="./Overview of Blocking vs Non-Blocking _ Node.js_files/prism-tomorrow.css" media="all">
  <script type="text/javascript">
    var $scrollToTop = document.getElementById('scroll-to-top');
    (window.onscroll = function() {
      $scrollToTop.style.display = (window.pageYOffset > window.innerHeight) ? 'block' : 'none';
    })();
    $scrollToTop.onclick = function() {
      window.scrollTo(0, 0);
      return false;
    };
  </script>
  
  <script>
    (function(d,e,m,s){
      if (!/(MSIE|Trident)/.test(navigator.userAgent)){return;}
      m=d.createElement(e);
      s=d.getElementsByTagName(e)[0];m.async=1;m.src='/static/js/modernizr.custom.js';
      m.onload=function(){Modernizr.addTest('flexboxtweener', Modernizr.testAllProps('flexAlign'));};
      s.parentNode.insertBefore(m,s);
    })(document,'script');
  </script>
  
  <script src="./Overview of Blocking vs Non-Blocking _ Node.js_files/dnt_helper.js.下载"></script>
  <script>
    if (!_dntEnabled()) {
      !function(n,o,d,e,j,s){n.GoogleAnalyticsObject=d;n[d]||(n[d]=function(){
      (n[d].q=n[d].q||[]).push(arguments)});n[d].l=+new Date;j=o.createElement(e);
      s=o.getElementsByTagName(e)[0];j.async=1;j.src='//www.google-analytics.com/analytics.js';
      s.parentNode.insertBefore(j,s)}(window,document,'ga','script');
  
      ga('create', 'UA-67020396-1', 'auto');
      ga('send', 'pageview');
    }
  </script>


</body></html>