<!DOCTYPE html>
<!-- saved from url=(0061)file:///C:/Users/bjzhangchengsi/Downloads/Node.js.html#view-2 -->
<html style="overflow-y: hidden;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Node.js</title>
  <link href="./新闻回流页_files/default.min.css" rel="stylesheet">
  <link href="./新闻回流页_files/solarized-light.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="./新闻回流页_files/viewScroller.css">
  <link rel="stylesheet" type="text/css" href="./新闻回流页_files/examples.css">
  <style>
    /* Styles specific for this example */
    .menu {
      right: 20px;
    }
    a {
      color: #fbfbfb !important;
      text-decoration: underline !important;
    }
    .panel {
      right: 0;
    }

    .forkme {
      left: 0;
    }
    .btn-own {
      width: 100px;
      text-align: center;
      font-face: 'Helvetica Neue',Helvetica,Arial,sans-serif;
    }
  </style>
</head>

<body style="overflow-y: hidden;">
  <div class="menu">
    <div class="buttons-section-fxd">
      <button id="fullScreen" class="btn-own btn-own-hidepanel raised center">Full</button>
    </div>
    <div class="buttons-section">
      <a href="http://f2e.developer.163.com/ybduan/share/#view-1" class="vs-anchor"><button class="btn-own btn-own-changeview raised center">项目背景</button></a>
    </div>
    <div class="buttons-section">
      <a href="http://f2e.developer.163.com/ybduan/share/#view-2" class="vs-anchor"><button class="btn-own btn-own-changeview raised center">项目架构</button></a>
    </div>
    <div class="buttons-section">
      <a href="http://f2e.developer.163.com/ybduan/share/#view-3" class="vs-anchor"><button class="btn-own btn-own-changeview raised center">项目流程</button></a>
    </div>
    <div class="buttons-section">
      <a href="http://f2e.developer.163.com/ybduan/share/#view-4" class="vs-anchor"><button class="btn-own btn-own-changeview raised center">踩过的坑</button></a>
    </div>
    <div class="buttons-section">
      <a href="http://f2e.developer.163.com/ybduan/share/#view-5" class="vs-anchor"><button class="btn-own btn-own-changeview raised center">代码质量</button></a>
    </div>
    <div class="buttons-section">
      <a href="http://f2e.developer.163.com/ybduan/share/#view-6" class="vs-anchor"><button class="btn-own btn-own-changeview raised center">共用代码</button></a>
    </div>
  </div>

  <div class="panel"></div>

  <div class="mainbag" style="width: 1366px; height: auto; transition: all 700ms ease 0ms; transform: translate3d(0px, -1178px, 0px); right: 0px;">
    <div vs-anchor="view-0" class="mainview view0" style="height: 589px;">
      <div class="vs-center-wrap">
        <div class="vs-center">
          <h1 style="font-size: 50px;">Node.js在回流页静态化中的应用</h1>
          <h2><a style="opacity: .3;" href="https://g.hz.netease.com/mf2e/assassins">https://g.hz.netease.com/mf2e/assassins</a></h2>
        </div>
      </div>
    </div>
    <div vs-anchor="view-1" class="mainview view1" style="height: 589px;">
      <div class="vs-center-wrap">
        <div class="vs-center">
          <h1>项目背景</h1>
          <ul>
            <li>加快页面渲染速度</li>
            <li>节约时间，利用现有代码</li>
            <li>SEO</li>
          </ul>
        </div>
      </div>
    </div>
    <div vs-anchor="view-2" class="mainview view2" style="height: 589px;">
      <div class="vs-center-wrap">
        <div class="vs-center">
          <h1>项目架构</h1>
          <img width="70%" src="./新闻回流页_files/structor.svg">
        </div>
      </div>
    </div>
    <div vs-anchor="view-3" class="mainview view3" style="height: 589px;">
      <div style="overflow: hidden; height: 100%; width: 100%;"><div style="overflow: hidden; height: 100%; width: 100%;"><div class="subbag subbag-0" style="width: 2732px; transition: all 1ms ease 0ms; transform: translate3d(0px, 0px, 0px);">
        <div vs-anchor="subview-3-a" class="subview subvie-3-a" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>项目流程</h1>
              <div style="display: flex; align-items: center;justify-content: center;">
                <img alt="webpack" width="200" src="./新闻回流页_files/logo.png">
                <img alt="babel" width="200" src="./新闻回流页_files/logo.svg">
                <img alt="gulp" width="200" src="./新闻回流页_files/gulp-white-text.svg" style="background-color: #cf4646">
                <a href="http://rollupjs.org/"><img alt="rollup" width="200" src="./新闻回流页_files/rollup.svg"></a>
                <a href="http://pm2.keymetrics.io/"><img alt="pm2" width="250" src="./新闻回流页_files/pm2.20d3ef.png"></a>

              </div>
              <div class="direction">&gt;&gt;</div>
            </div>
          </div>
        </div>
        <div vs-anchor="subview-3-b" class="subview subview-3-b" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>项目流程</h1>
              <ul>
                <li>开发： npm run dev</li>
                <li>单元测试： npm test</li>
                <li>测试（部署资源到测试服务器）： gulp test -w [type]</li>
                <li>部署（前端静态资源）： npm run deploy [type]</li>
                <li>部署（后端服务）： git push &amp;&amp; 自动化部署系统</li>
              </ul>
              <div class="direction">&lt;&lt;</div>
            </div>
          </div>
        </div>
      </div></div></div>
    </div>
    <div vs-anchor="view-4" class="mainview view4" style="height: 589px;">
      <div style="overflow: hidden; height: 100%; width: 100%;"><div style="overflow: hidden; height: 100%; width: 100%;"><div class="subbag subbag-1" style="width: 5464px; transition: all 1ms ease 0ms; transform: translate3d(0px, 0px, 0px);">
        <div vs-anchor="subview-4-a" class="subview subview-4-a" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>踩过的坑</h1>
              <ul>
                <li>安装与版本管理   =&gt; <a href="https://github.com/creationix/nvm">nvm</a></li>
                <li>内存占用问题，如何发现调试资源消耗过多</li>
                <li>如何debug</li>
                <li>日志记录</li>
                <li>ES6特性</li>
              </ul>
              <div class="direction">&gt;&gt;</div>
            </div>
          </div>
        </div>
        <div vs-anchor="subview-4-b" class="subview subview-4-b" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>内存占用</h1>
              <div><a href="https://nodejs.org/en/docs/guides/simple-profiling/">https://nodejs.org/en/docs/guides/simple-profiling/</a></div>
<pre><code class="javascript hljs">
app.get(<span class="hljs-string"><span class="hljs-string">'/auth'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username = req.query.username || <span class="hljs-string"><span class="hljs-string">''</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password = req.query.password || <span class="hljs-string"><span class="hljs-string">''</span></span>;

  username = username.replace(<span class="hljs-regexp"><span class="hljs-regexp">/[!@#$%^&amp;*]/g</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);

  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!username || !password || !users[username]) {
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.sendStatus(<span class="hljs-number"><span class="hljs-number">400</span></span>);
  }

  <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hash = crypto.pbkdf2Sync(password, users[username].salt, <span class="hljs-number"><span class="hljs-number">10000</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>);

  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (users[username].hash.toString() === hash.toString()) {
    res.sendStatus(<span class="hljs-number"><span class="hljs-number">200</span></span>);
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
    res.sendStatus(<span class="hljs-number"><span class="hljs-number">401</span></span>);
  }
});
</code>
<code class="Bash hljs">
node --prof app.js
ab -k -c 20 -n 250 <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/auth?username=matt&amp;password=password"</span></span>
node --prof-process isolate-xxxxxx.log &gt; processed.txt
</code>
</pre>
              <div class="direction">&gt;&gt;</div>

            </div>
          </div>
        </div>
        <div vs-anchor="subview-4-c" class="subview subview-4-c" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>内存占用</h1>
<pre><code class="accesslog hljs css">
<span class="hljs-selector-attr"><span class="hljs-selector-attr">[Summary]</span></span>:
 <span class="hljs-selector-tag"><span class="hljs-selector-tag">ticks</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">total</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">nonlib</span></span>   <span class="hljs-selector-tag"><span class="hljs-selector-tag">name</span></span>
   79    0<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>%    0<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>%  <span class="hljs-selector-tag"><span class="hljs-selector-tag">JavaScript</span></span>
36703   97<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>%   99<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>%  <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>++
    7    0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%    0<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%  <span class="hljs-selector-tag"><span class="hljs-selector-tag">GC</span></span>
  767    2<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%          <span class="hljs-selector-tag"><span class="hljs-selector-tag">Shared</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">libraries</span></span>
  215    0<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span>%          <span class="hljs-selector-tag"><span class="hljs-selector-tag">Unaccounted</span></span>

<span class="hljs-selector-attr"><span class="hljs-selector-attr">[C++]</span></span>:
 <span class="hljs-selector-tag"><span class="hljs-selector-tag">ticks</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">total</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">nonlib</span></span>   <span class="hljs-selector-tag"><span class="hljs-selector-tag">name</span></span>
19557   51<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>%   52<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>%  <span class="hljs-selector-tag"><span class="hljs-selector-tag">node</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::crypto</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::PBKDF2(v8</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::FunctionCallbackInfo</span></span><v8::value> <span class="hljs-selector-tag"><span class="hljs-selector-tag">const</span></span>&amp;)
 4510   11<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>%   12<span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span>%  _<span class="hljs-selector-tag"><span class="hljs-selector-tag">sha1_block_data_order</span></span>
 3165    8<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span>%    8<span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span>%  _<span class="hljs-selector-tag"><span class="hljs-selector-tag">malloc_zone_malloc</span></span>
</v8::value></code>
<code class="accesslog hljs css">
<span class="hljs-selector-tag"><span class="hljs-selector-tag">ticks</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">parent</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">name</span></span>
19557   51<span class="hljs-selector-class"><span class="hljs-selector-class">.8</span></span>%  <span class="hljs-selector-tag"><span class="hljs-selector-tag">node</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::crypto</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::PBKDF2(v8</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::FunctionCallbackInfo</span></span><v8::value> <span class="hljs-selector-tag"><span class="hljs-selector-tag">const</span></span>&amp;)
19557  100<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%    <span class="hljs-selector-tag"><span class="hljs-selector-tag">v8</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::internal</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">::Builtins</span></span>::~<span class="hljs-selector-tag"><span class="hljs-selector-tag">Builtins</span></span>()
19557  100<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%      <span class="hljs-selector-tag"><span class="hljs-selector-tag">LazyCompile</span></span>: ~<span class="hljs-selector-tag"><span class="hljs-selector-tag">pbkdf2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crypto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:557</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:16</span></span>

 4510   11<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>%  _<span class="hljs-selector-tag"><span class="hljs-selector-tag">sha1_block_data_order</span></span>
 4510  100<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%    <span class="hljs-selector-tag"><span class="hljs-selector-tag">LazyCompile</span></span>: *<span class="hljs-selector-tag"><span class="hljs-selector-tag">pbkdf2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crypto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:557</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:16</span></span>
 4510  100<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%      <span class="hljs-selector-tag"><span class="hljs-selector-tag">LazyCompile</span></span>: *<span class="hljs-selector-tag"><span class="hljs-selector-tag">exports</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pbkdf2Sync</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crypto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:552</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:30</span></span>

 3165    8<span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span>%  _<span class="hljs-selector-tag"><span class="hljs-selector-tag">malloc_zone_malloc</span></span>
 3161   99<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span>%    <span class="hljs-selector-tag"><span class="hljs-selector-tag">LazyCompile</span></span>: *<span class="hljs-selector-tag"><span class="hljs-selector-tag">pbkdf2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crypto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:557</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:16</span></span>
 3161  100<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span>%      <span class="hljs-selector-tag"><span class="hljs-selector-tag">LazyCompile</span></span>: *<span class="hljs-selector-tag"><span class="hljs-selector-tag">exports</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pbkdf2Sync</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">crypto</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.js</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:552</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:30</span></span>
</v8::value></code>
</pre>
              <div class="direction">&gt;&gt;</div>
            </div>
          </div>
        </div>
        <div vs-anchor="subview-4-d" class="subview subview-d" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>DEBUG</h1>
              <ul>
                <li>
                  node-inspector(v6.3.0以下)
<pre><code class="hljs nginx">
<span class="hljs-attribute"><span class="hljs-attribute">node</span></span> --<span class="hljs-literal"><span class="hljs-literal">debug</span></span> app.js
node-inspector
// 提示访问 http://127.0.0.1:8080/?port=5858
</code>
</pre>
                </li>
                <li>
                  <a href="https://medium.com/@paul_irish/debugging-node-js-nightlies-with-chrome-devtools-7c4a1b95ae27#.5bb4hvsmb">Node.js本身支持(v6.3.0以上) + (chrome 55+)</a>
<pre><code class="hljs cpp">
node --inspect app.js
<span class="hljs-comment"><span class="hljs-comment">// 提示访问</span></span>
chrome-devtools:<span class="hljs-comment"><span class="hljs-comment">//devtools/remote/serve_file/@60cd6e859b9f557d2312f5bf532f6aec5f284980/inspector.html?experiments=true&amp;v8only=true&amp;ws=localhost:9229/f9a8269c-04bc-4620-8558-06b26d65ed21</span></span>
<span class="hljs-comment"><span class="hljs-comment">// 存在问题，每次重启服务器，地址都发生变化</span></span>
<span class="hljs-comment"><span class="hljs-comment">/*
解决办法
更改chrome 启动方式，增加参数  --remote-debugging-targets=localhost:5858,9229
访问 chrome://inspect
 */</span></span>
</code>
</pre>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div></div></div>
    </div>
    <div vs-anchor="view-5" class="mainview  view5" style="height: 589px;">
      <div style="overflow: hidden; height: 100%; width: 100%;"><div style="overflow: hidden; height: 100%; width: 100%;"><div class="subbag subbag-2" style="width: 2732px; transition: all 1ms ease 0ms; transform: translate3d(0px, 0px, 0px);">
        <div vs-anchor="subview-d" class="subview subview-d" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>代码规范</h1>
              <a href="http://eslint.org/"><img width="200" alt="eslint" src="./新闻回流页_files/logo(1).svg"></a>
              <a href="https://github.com/airbnb/javascript"><img width="200" alt="airbnb" src="./新闻回流页_files/logo-red.png"></a>
              <div class="direction">&gt;&gt;</div>
            </div>
          </div>
        </div>
        <div vs-anchor="subview-e" class="subview subview-e" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>单元测试</h1>
              <div style="display: flex; justify-content: center; align-items: center;">
                <a href="https://facebook.github.io/jest/"><img width="200" alt="jest" src="./新闻回流页_files/jest-outline.svg"></a>
                <a href="https://travis-ci.org/"><img width="200" alt="travis-ci" src="./新闻回流页_files/assassins.svg"></a>
              </div>
              <div class="direction">&lt;&lt;</div>
            </div>
          </div>
        </div>
      </div></div></div>
    </div>
    <div vs-anchor="view-6" class="mainview view6" style="height: 589px;">
      <div style="overflow: hidden; height: 100%; width: 100%;"><div style="overflow: hidden; height: 100%; width: 100%;"><div class="subbag subbag-3" style="width: 1366px; transition: all 1ms ease 0ms; transform: translate3d(0px, 0px, 0px);">
        <div vs-anchor="subview-e" class="subview subview-e" style="width: 1366px;">
          <div class="vs-center-wrap">
            <div class="vs-center">
              <h1>公用代码</h1>
              <h2></h2>
              <ul class="ul">
                <li>什么样的代码可以公用？ =&gt; 不依赖特定的环境 =&gt; 纯函数</li>
                <li>
                  使用场景
                  <ul>
                    <li>表单校验</li>
                    <li>服务端渲染（server render）</li>
                    <li>工具方法</li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
        </div>

      </div></div></div>
    </div>
  </div>

  <script src="./新闻回流页_files/jquery-3.1.0.min.js.下载"></script>
  <script src="./新闻回流页_files/jquery.easing.min.js.下载"></script>
  <script src="./新闻回流页_files/jquery.mousewheel.min.js.下载"></script>
  <script src="./新闻回流页_files/viewScroller.js.下载"></script>
  <script src="./新闻回流页_files/highlight.min.js.下载"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script>
    $(document).ready(function() {
      // Sets viewScroller
      $('.mainbag').viewScroller({
        useScrollbar: false
      });

      // Sets start params for MENU
      $('.mainbag').css({
        'right': '0px'
      });
      // $.fn.viewScroller.setSpaceMainBag(140); // Sets 140px space for MENU
      $('#fullScreen').on('click', function() {
        document.documentElement.webkitRequestFullScreen()
      })
      // Show / hide menu panel
      $('#hidePanel').on('click', function() {
        if ($('.panel').css('display') !== 'none') {
          $('#hidePanel').text('<<');
          $('.panel').hide();
          $.fn.viewScroller.setSpaceMainBag(0); // sets mainbag's width when panel is closed
        } else {
          $('#hidePanel').text('>>');
          $('.panel').show();
          $.fn.viewScroller.setSpaceMainBag(140); // sets mainbag's width when panel is open
        }
      });

      //Show / hide examples panel
      $('.examples').hide();
      $('.examples-show').click(function() {
        $('.examples').toggle();
      });

      // Turnon / turnoff the scroll views when they are animate
      $('#scroll').on('click', function() {
        if ($('#scroll').prop("checked")) {
          $.fn.viewScroller.setChangeWhenAnim(true);
        } else {
          $.fn.viewScroller.setChangeWhenAnim(false);
        }
      });

    });
  </script>



</body></html>